<html>
    <head>
        <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-motion-capture-components/dist/aframe-motion-capture-components.min.js"></script>
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v3.9.0/dist/aframe-extras.min.js"></script>
        <script src="https://unpkg.com/super-hands@1.0.1/dist/super-hands.min.js"></script>
        <script src="https://unpkg.com/aframe-cubemap-component@0.1.2/dist/aframe-cubemap-component.min.js"></script>
        <script src="https://etiennepinchon.github.io/aframe-rounded/lib/rounded.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            //Function to set multiple attributes at the same time
            function setAttributes(el, attrs) {
              for(var key in attrs) {
                el.setAttribute(key, attrs[key]);
              }
            }

            AFRAME.registerComponent('cursor-scale', {
                schema: {
                    to: {default: '2.5 2.5 2.5'}
                },
                init: function () {
                    // Do something when component first attached.
                    var data = this.data;

                    var mouseEnterAnim = document.createElement("a-animation");
                    var mouseLeaveAnim = document.createElement("a-animation");
                    var clickAnim = document.createElement("a-animation");

                    mouseEnterAnim.setAttribute("attribute", "scale");
                    mouseEnterAnim.setAttribute("begin", "mouseenter");
                    mouseEnterAnim.setAttribute("dur", "100");
                    mouseEnterAnim.setAttribute("to", "2.5 2.5 2.5");

                    mouseLeaveAnim.setAttribute("attribute", "scale");
                    mouseLeaveAnim.setAttribute("begin", "mouseleave");
                    mouseLeaveAnim.setAttribute("dur", "300");
                    mouseLeaveAnim.setAttribute("to", "1 1 1");

                    clickAnim.setAttribute("attribute", "rotation");
                    clickAnim.setAttribute("begin", "click");
                    clickAnim.setAttribute("dur", "2000");
                    clickAnim.setAttribute("to", "360 405 45");

                    console.log(mouseEnterAnim);
                    console.log(this.el);

                    this.el.appendChild(mouseEnterAnim);
                    this.el.appendChild(mouseLeaveAnim);
                    this.el.appendChild(clickAnim);


                    /*this.el.addEventListener("mouseenter", function(){
                        this.setAttribute("scale", data.to);
                    });
                    this.el.addEventListener("mouseleave", function(){
                        this.setAttribute("scale", data.default);
                    }); */
                }
            });
            AFRAME.registerComponent('many-cube', {
                schema: {
                    event: {type: 'string', default: ''},
                    message: {type: 'string', default: 'Hello, World!'}
                },
                init: function () {
                    //Unable to get this to work using loader but keeping code for this type of texturing for reference
                    /*var loader = new THREE.CubeTextureLoader();
                    loader.setPath('./images/');

                    var textureCube = loader.load( [
                    	'posx.jpg', 'negx.jpg',
                    	'posy.jpg', 'negy.jpg',
                    	'posz.jpg', 'negz.jpg'
                    ] );

                    var material = new THREE.MeshFaceMaterial( { color: 0xffffff, envMap: textureCube } );*/

                    var textureLoader = new THREE.TextureLoader();

                    var texture0 = textureLoader.load( 'https://ucarecdn.com/d8459766-0eeb-4fac-b605-091aa4f5171c/' );
                    var texture1 = textureLoader.load( 'https://ucarecdn.com/3e1feafb-efcf-4f38-8585-0affc8dcacca/' );
                    var texture2 = textureLoader.load( 'https://ucarecdn.com/eac38c24-92a5-4e70-8c5a-9c53db2248ec/' );
                    var texture3 = textureLoader.load( 'https://ucarecdn.com/3a94eef7-1436-48d7-a878-a78cb2e1fa67/' );
                    var texture4 = textureLoader.load( 'https://ucarecdn.com/4f3972b5-66ca-4579-99e3-ae984c9d91ce/' );
                    var texture5 = textureLoader.load( 'https://ucarecdn.com/0e1a6433-4961-47d9-99ea-d90230bcf3e6/' );

                    var materials = [
                        new THREE.MeshBasicMaterial( { map: texture0 } ),
                        new THREE.MeshBasicMaterial( { map: texture1 } ),
                        new THREE.MeshBasicMaterial( { map: texture2 } ),
                        new THREE.MeshBasicMaterial( { map: texture3 } ),
                        new THREE.MeshBasicMaterial( { map: texture4 } ),
                        new THREE.MeshBasicMaterial( { map: texture5 } )
                    ];

                    var material = new THREE.MultiMaterial( materials );

                    /* Example of transparent textures and coloring
                    var cubeMaterials = [
                        new THREE.MeshBasicMaterial({color:0x33AA55, transparent:true, opacity:0.8, side: THREE.DoubleSide}),
                        new THREE.MeshBasicMaterial({color:0x55CC00, transparent:true, opacity:0.8, side: THREE.DoubleSide}),
                        new THREE.MeshBasicMaterial({color:0x000000, transparent:true, opacity:0.2, side: THREE.DoubleSide}),
                        new THREE.MeshBasicMaterial({color:0xFF0000, transparent:true, opacity:0.8, side: THREE.DoubleSide}),
                        new THREE.MeshBasicMaterial({color:0xFF0000, transparent:true, opacity:0.8, side: THREE.DoubleSide}),
                        new THREE.MeshBasicMaterial({color:0x5555AA, transparent:true, opacity:0.8, side: THREE.DoubleSide}),
                    ];*/

                    // Create a MeshFaceMaterial, which allows the cube to have different materials on each face
                    //var material = new THREE.MeshFaceMaterial(cubeMaterials);

                    var geometry = new THREE.CubeGeometry( .5, .5, .5 );

                    var mesh = new THREE.Mesh( geometry, material );
                    this.el.setObject3D("mesh", mesh);
                },
                update: function () {
                    // Do something when component's data is updated.
                },
                remove: function () {
                    // Do something the component or its entity is detached.
                },
                tick: function (time, timeDelta) {
                    // Do something on every scene tick or frame.
                }
            });

            AFRAME.registerComponent('avatar', {
                schema: {
                    event: {type: 'string', default: ''},
                    message: {type: 'string', default: 'Hello, World!'}
                },

                init: function () {
                    // Do something when component first attached.
                    loader = new THREE.JSONLoader();
                    loader.load( 'https://ucarecdn.com/b229522f-bde3-49d4-bd0f-5b6313bb593f/', addModel );
                    var mesh;
                    var group;
                    function addModel(geometry,  materials){
                        materials[0].skinning = true;

                        //var cs = scaleVal * Math.random();

                        var avatar = new THREE.SkinnedMesh( geometry, new THREE.MultiMaterial(materials) );
                        //set[i].position.set(Math.random()*250,Math.random()*250,Math.random()*250);
                        //set[i].scale.set (cs, cs, cs);
                        avatar.castShadow = true;
                        avatar.receiveShadow = true;

                        //scene.add(set[i]);
                        //helpset[i] = new THREE.SkeletonHelper(set[i]);
                        //scene.add(helpset[i]);
                        mesh = new THREE.Mesh(avatar.geometry, avatar.materials);
                        group = new THREE.Object3D();//create an empty container
                        group.add( mesh );//add a mesh with geometry to it
                    }

                    this.el.setObject3D("mesh", group)
                },
                update: function () {
                    // Do something when component's data is updated.
                },
                remove: function () {
                    // Do something the component or its entity is detached.
                },
                tick: function (time, timeDelta) {
                    // Do something on every scene tick or frame.
                }

            });

            AFRAME.registerComponent('get-controller-pos', {
                schema: {
                    event: {type: 'string', default: ''},
                    message: {type: 'string', default: 'Hello, World!'}
                },
                init: function () {
                    // Do something when component first attached.
                },
                update: function () {
                    // Do something when component's data is updated.
                },
                remove: function () {
                    // Do something the component or its entity is detached.
                },
                tick: function (time, timeDelta) {
                    // Do something on every scene tick or frame.
                    //console.log(this.el.object3D.position);
                }
            });

            /*AFRAME.registerComponent('bluemat', {

                multiple: true,

                init: function (){
                    var textureLoader = new THREE.TextureLoader();
                    var texture = textureLoader.load( 'https://ucarecdn.com/368ba9a7-d6ad-4bee-ac49-b76f315000e3/' );
                    var material = new THREE.MeshBasicMaterial({ map: texture });
                    var geometry = this.el.getObject3D('mesh');
                    this.el.setObject3D('mesh', new THREE.Mesh(geometry, material));
                },

                remove: function(){
                    this.el.removeObject3D('mesh');
                }

            });*/
            var mybone;
            var start = false;

            AFRAME.registerComponent('bones', {
                init: function () {
                    // Do something when component first attached.
                    var source = this.el;
                    console.log(source.object3D);

                    source.addEventListener("loaded", function(source){
                        var jsonmodel;
                        jsonmodel = source.target.components["json-model"];
                        console.log(jsonmodel);
                        console.log("loaded call");

                        //Hack - Wait 5 seconds before grabbing model reference due to loading lifecycle issues
                        window.setTimeout(function(){
                            start = true;
                            console.log(jsonmodel.model.skeleton.bones[4]);
                            mybone = jsonmodel.model.skeleton.bones[4];
                            console.log("My Bone = " + mybone);
                        }, 5000);
                    });
                },
                update: function () {
                    // Do something when component's data is updated.
                },
                remove: function () {
                    // Do something the component or its entity is detached.
                },
                tick: function (time, timeDelta) {
                    // Do something on every scene tick or frame.
                    if(start){
                        //mybone.position.y += 0.001;
                    }
                }
            });

            AFRAME.registerComponent('curvedvideo', {
                init: function () {
                    // Do something when component first attached.
                    var front = document.createElement("a-curvedimage");
                    var back = document.createElement("a-curvedimage");

                    setAttributes(front, {
                        //"src": "#xvr",
                        "src": "https://ucarecdn.com/40817a04-ea96-415e-8cf4-cca1b144711f/",
                        "height": "3.0",
                        "theta-start": "144",
                        "theta-length": 100,
                        "rotation": "0 0 0",
                        "material": "side:single; repeat:1 1",
                        "scale": "-2 0.8 0.8",
                        "position": "0 1 0",
                        "stretchable": "",
                        "grabbable": ""
                    });

                    setAttributes(back, {
                        "src": "https://ucarecdn.com/4130c599-445f-4e76-9052-49978e972641/",
                        //"src": "#paris",
                        "height": "3.0",
                        "theta-start": "144",
                        "theta-length": 100,
                        "rotation": "0 0 0",
                        "material": "side:single; repeat:1 1",
                        "scale": "2 0.8 0.8",
                        "position": "0 1 0",
                        "stretchable": "",
                        "grabbable": ""
                    });

                    this.el.appendChild(front);
                    this.el.appendChild(back);
                }
            });

            AFRAME.registerComponent('gridmenu', {
                schema: {
                    layout: {type: 'string', default: 'bestfit'},
                },

                init: function () {
                    // Do something when component first attached.
                    var element = this.el;
                    var videoPlaying = false;
                    var layout = this.data.layout;
                    var list = ["Return to Lobby", "Change Ownership", "Place Objects","Mute Self"];
                    console.log("The layout of this grid = " + layout);

                    //loop through 2D array to print menu as grid
                    list.forEach(function(item, array){
                        var text = document.createElement("a-text");
                        setAttributes(text, {
                            "value": item,
                            "stretchable": "",
                            "grabbable": "",
                            "geometry": "primitive:plane",
                            "width": "2",
                            "height": "2",
                            "align": "center",
                            "wrapCount": 5
                        });
                        /*text.addEventListener("click", function(){
                            if(item === "Change Ownership"){
                                element.sceneEl.insertAdjacentHTML('beforeend','<a-entity id="objectmenu" objectmenu position="-3 2.5 0" rotation="0 90 0"></a-entity>');
                                element.sceneEl.removeChild(element);
                            }
                        });*/
                        element.appendChild(text);
                    });

                    setLayout();

                    function setLayout(){
                        switch (layout) {
                            default:
                                //Default to 'bestfit'
                                var children = element.components.gridmenu.el.children;
                                var listLength = children.length;
                                var width = Math.round(Math.sqrt(listLength)); //x is not growing so will always be shorter
                                var ywidth = Math.ceil(listLength / width); //handles cases where the factors are not perfect example 30
                                console.log(width);

                                var xoff = width / 2 + .5; //starting point is an offset of half the width of the grid + .5 for center multiplied by -1
                                var yoff = ywidth / 2 + .5;

                                for(i = 0; i < listLength; i++){
                                    var child = children[i];
                                    var x = i % width + 1; //adding one makes it go from 1 - 4 instead of 0 to 1 to avoid 0 division
                                    var y = Math.floor(i / width) + 1; //adding one makes it go from 1 - 4 instead of 0 to 1 to avoid 0 division
                                    console.log(x + ", " + y);
                                    child.setAttribute("position", {x:(x - xoff), y:(y - yoff), z:0});
                                    console.log(child.components.position);
                                }
                                break;
                        }
                    }
                }
            });

            AFRAME.registerComponent('objectmenu', {
                schema: {
                    layout: {type: 'string', default: 'bestfit'},
                    selected: {type: 'string', default: ''}
                },

                init: function () {
                    // Do something when component first attached.
                    var element = this.el;
                    var videoPlaying = false;
                    var layout = this.data.layout;
                    var selected = this.data.selected;
                    var topofmenu = 0;
                    var camera = element.sceneEl.querySelector("a-camera");
                    var cameraPosition = camera.getAttribute("position");
                    var cameraRotation = camera.getAttribute("rotation");
                    var parent = element.parentEl;
                    var list = ["Change Source", "Change Color", "Move Object","Video Controls"];

                    //loop through 2D array to print menu as grid
                    list.forEach(function(item, array){
                        var text = document.createElement("a-text");
                        setAttributes(text, {
                            "value": item,
                            "geometry": "primitive:plane",
                            "width": "2",
                            "height": "2",
                            "align": "center",
                            "wrapCount": 100
                        });
                        text.addEventListener("click", function(){
                            console.log("You just clicked " + item);
                            if(item === "Video Controls"){
                                if(!videoPlaying){
                                  element.sceneEl.insertAdjacentHTML('beforeend','<a-entity id="curvedvideo" curvedvideo position="0 0 -3" scale=".75 .75 .75"></a-entity>');
                                  videoPlaying = true;
                                }
                            }
                        });
                        element.appendChild(text);
                    });
                    //Shared Element
                    var sharedEl = document.querySelector(selected);
                    var shared = sharedEl.cloneNode("true");

                    //Back Button
                    var back = document.createElement("a-text");
                    setAttributes(back, {
                        "value": "Main Menu",
                        "geometry": "primitive:plane",
                        "width": "2",
                        "height": "2",
                        "align": "center",
                        "wrapCount": 5
                    });
                    back.addEventListener("click", function(){
                          element.sceneEl.insertAdjacentHTML('beforeend','<a-entity id="gridmenu" gridmenu position="-3 2.5 0" rotation="0 90 0"></a-entity>');
                          element.sceneEl.removeChild(parent);
                    });

                    //Dismiss Button
                    var dismiss = document.createElement("a-text");
                    setAttributes(dismiss, {
                        "value": "Dismiss",
                        "geometry": "primitive:plane",
                        "width": "2",
                        "height": "2",
                        "align": "center",
                        "wrapCount": 5
                    });
                    dismiss.addEventListener("click", function(){
                        element.sceneEl.removeChild(parent);
                    });

                    setLayout();

                    shared.setAttribute("position", {x:0, y:topofmenu, z:0});
                    shared.setAttribute("rotation", "0 0 0");
                    shared.setAttribute("scale", "1 1 1");
                    shared.insertAdjacentHTML('beforeend','<a-animation attribute="rotation" dur="10000" fill="forwards" to="0 360 0" repeat="indefinite"></a-animation>');
                    back.setAttribute("position", {x:-1, y:topofmenu, z:0});
                    dismiss.setAttribute("position", {x:1, y:topofmenu, z:0});
                    element.appendChild(shared);
                    element.appendChild(back);
                    element.appendChild(dismiss);

                    //Animate menu locally from its wrapper object
                    element.insertAdjacentHTML('beforeend','<a-animation attribute="scale" from="0 0 0" to=".5 .5 .5"></a-animation>');
                    element.insertAdjacentHTML('beforeend','<a-animation attribute="position" to=".5 0 -2"></a-animation>');

                    function setLayout(){
                        //Set parent object position to users camera for relative adjustments
                        parent.setAttribute("position", {x:cameraPosition.x, y:cameraPosition.y, z:cameraPosition.z});
                        parent.setAttribute("rotation", {x:cameraRotation.x, y:cameraRotation.y, z:cameraRotation.z});

                        var animRot = document.createElement("a-animation");
                        var offsetY = cameraRotation.y - 15;
                        if(cameraRotation.y < 0){
                            cameraRotation + 30;
                        }
                        var rotTo = cameraRotation.x + " " + offsetY + " " + cameraRotation.z;
                        var rotFrom = cameraRotation.x + " " + cameraRotation.y + " " + cameraRotation.z;
                        animRot.setAttribute("to", rotTo);
                        animRot.setAttribute("from", rotFrom);
                        animRot.setAttribute("attribute", "rotation");
                        parent.appendChild(animRot);

                        //Push menu in front of user by 2
                        element.setAttribute("position", {x:0, y:0, z:-2}); //need wrapper parent to push this forward locally

                        switch (layout) {
                            default:
                                //Default to 'bestfit'
                                var children = element.components.objectmenu.el.children;
                                var listLength = children.length;
                                var width = Math.round(Math.sqrt(listLength)); //x is not growing so will always be shorter
                                var ywidth = Math.ceil(listLength / width); //handles cases where the factors are not perfect example 30
                                topofmenu = ywidth;
                                console.log(width);

                                var xoff = width / 2 + .5; //starting point is an offset of half the width of the grid + .5 for center multiplied by -1
                                var yoff = ywidth / 2 + .5;

                                for(i = 0; i < listLength; i++){
                                    var child = children[i];
                                    var x = i % width + 1; //adding one makes it go from 1 - 4 instead of 0 to 1 to avoid 0 division
                                    var y = Math.floor(i / width) + 1; //adding one makes it go from 1 - 4 instead of 0 to 1 to avoid 0 division
                                    console.log(x + ", " + y);
                                    child.setAttribute("position", {x:(x - xoff), y:(y - yoff), z:0});
                                    console.log(child.components.position);
                                }
                                break;
                        }
                    }
                }
            });
            //TODO make functions for layout and generating grid assets from list to be used in multiple components

            AFRAME.registerComponent('menuable', {
                init: function () {
                    // Do something when component first attached.
                    var element = this.el;
                    element.addEventListener("click", function(){
                        //Throw up object menu if it is not already up & the item has an id
                        if(!document.querySelector("#objectmenu") && element.getAttribute("id")){
                            var menuhtml = '<a-entity id="obmenuwrap"><a-entity id="objectmenu" objectmenu="selected: #' + element.getAttribute("id") + '"></a-entity></a-entity>';
                            element.sceneEl.insertAdjacentHTML('beforeend', menuhtml);
                        }
                    });
                }
            });

            AFRAME.registerComponent('welcomemessage', {
                  schema: {
                      text: {type: 'string', default: ''},
                      bgcolor: {type: 'string', default: ''},
                      textcolor: {type: 'string', default:''},
                      duration: {type: 'int', default: 0},
                  },
                  init: function () {
                      // Do something when component first attached.
                      var element = this.el;
                      var roundUI = document.createElement("a-rounded");
                      var text = document.createElement("a-text");
                      var image = document.createElement("a-image");

                      setAttributes(roundUI, {
                          "height": "3",
                          "width": "10",
                          "color": this.data.bgcolor,
                          "opacity": ".8",
                          "radius":"1",
                          "position":"-5, -2.5, 0"
                      });

                      setAttributes(text, {
                          "value": this.data.text,
                          "height": "auto",
                          "width": "auto",
                          "color": this.data.textcolor,
                          "opacity": "1",
                          "align": "center",
                          "scale": "6 5 0",
                          //"geometry":"primitive:plane",
                          "position":"6.25, 1.5, .1"
                      });

                      setAttributes(image, {
                          "src": "#iconcl",
                          "scale": "2, 1.14, 2",
                          "position":"-3.25, -1, .1",
                          "material": "alphaTest:0.5;"
                      });

                      roundUI.appendChild(text);
                      element.appendChild(image);
                      element.appendChild(roundUI);

                      element.addEventListener("click", function(){
                          element.sceneEl.removeChild(element);
                      });
                  }
              });
        </script>
        <a-scene avatar-recorder>
            <a-assets>
                <img id="boxTexture" src="https://i.imgur.com/mYmmbrp.jpg" crossorigin="true"/>
                <img id="skyTexture" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg" crossorigin="true"/>
                <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="true"/>
                <img id="ejbluemat" src="https://ucarecdn.com/e8271956-254d-4bd5-85a4-02ba6d21578b/" crossorigin="true"/>
                <img id="imagestretch" src="https://ucarecdn.com/0e1a6433-4961-47d9-99ea-d90230bcf3e6/" crossorigin="true"/>
                <img id="iconcl" src="https://ucarecdn.com/dfa1bdf4-c47b-4287-a8e6-dbdaac79e13e/" crossorigin="true"></a-asset-item>
                <!--<video id="xvr" autoplay loop="true" src="https://ucarecdn.com/40817a04-ea96-415e-8cf4-cca1b144711f/" crossorigin="true"></video>
                <video id="paris" autoplay loop="true" src="https://ucarecdn.com/4130c599-445f-4e76-9052-49978e972641/" crossorigin="true"></video>-->
                <!--<video id="xvr" autoplay loop="true" src="https://ucarecdn.com/fadab25d-0b3a-45f7-8ef5-85318e92a261/" crossorigin="true"></video>-->
                <!--<video id="xvr" autoplay loop="true" src="https://ucarecdn.com/4130c599-445f-4e76-9052-49978e972641/" crossorigin="true"></video>-->
                <!--<audio id="spatialaudio"src="https://cdn.aframe.io/basic-guide/audio/backgroundnoise.wav"></audio>-->
                <audio id="spatialaudio" src="https://ucarecdn.com/53fd1dd9-0813-46ef-b02c-4e9e4638053f/" preload crossorigin="true"></audio>
                <!--<a-asset-item id="firstchair" src="https://ucarecdn.com/86a52a70-f451-4e0b-afdc-7dc5915577a9/" crossorigin="true"></a-asset-item>-->
                <a-asset-item id="firstchairobj" src="https://ucarecdn.com/9d5845c1-e5ba-4ca1-878f-0920b1238846/" crossorigin="true"></a-asset-item>
                <!--<a-asset-item id="arpitavatar" src="https://ucarecdn.com/e980bad3-2dc4-4ad0-81fc-73726c5e3b5a/" crossorigin="true"></a-asset-item>
                <a-asset-item id="arpitcollada" src="https://ucarecdn.com/8265dce7-cb66-4804-a59f-fbf5b84fb0d3/" crossorigin="true"></a-asset-item>-->
                <a-asset-item id="arpitjson" src="https://ucarecdn.com/765fd642-61ed-4bac-a13a-dc1b21429b67/" crossorigin="true"></a-asset-item>
                <!-- Old Blue Model <a-asset-item id="arpitjson" src="https://ucarecdn.com/b229522f-bde3-49d4-bd0f-5b6313bb593f/" crossorigin="true"></a-asset-item> -->
                <!-- <a-asset-item id="firstchairobj" src="https://ucarecdn.com/66de89a6-8747-4bff-9993-5e2977a79445/" crossorigin="true"></a-asset-item> -->
            </a-assets>
            <a-box id="redbox" src="#boxTexture" color="red" position="5 2 -4" rotation="0 45 45" scale="2 2 2" cursor-scale menuable>
                <!-- These animations are now added with the cursor-scale custom component I wrote!
                <a-animation attribute="scale" begin="mouseenter" dur="300" to="2.3 2.3 2.3"></a-animation>
                <a-animation attribute="scale" begin="mouseleave" dur="300" to="2 2 2"></a-animation>
                <a-animation attribute="rotation" begin="click" dur="2000" to="360 405 45"></a-animation> -->
            </a-box>
            <a-sky src="#skyTexture"></a-sky>
            <a-plane src="#groundTexture" height="30" width="30" rotation="-90 0 0" repeat="10 10"></a-plane>
            <a-light type="ambient" color="#445451"></a-light>
            <a-light type="point" intensity="2" position="2 4 4"></a-light>
            <!--<a-sound src="#spatialaudio" autoplay="true" position="0 0 0"></a-sound>-->
            <a-text value="Click Me!" color="#BBB" position="4 0.2 -4" scale="1.5 1.5 1.5" rotation="0 -40 0"></a-text>

            <!-- Super hands does not work on custom models. Need to wrap custom models with other components to have them move! -->
            <a-box id="bluechair" position="-1.5 .25 .5" rotation="0 -90 0" alpha="0" material="opacity:0" grabbable stretchable menuable>
                <a-entity obj-model="obj: #firstchairobj;" material="src:#ejbluemat;" scale=".25 .25 .25"></a-entity>
            </a-box>

            <a-entity id="many-cube" many-cube position= ".5 1.5 .5" grabbable stretchable menuable></a-entity>

            <a-entity id="maincamera" position="0 0 0">
                <a-camera>
                    <a-cursor id="maincursor" color="yellow"></a-cursor>
                </a-camera>
            </a-entity>
            <a-entity id="controller1" hand-controls="left" super-hands sphere-collider="objects: a-entity, a-box, a-image, a-video, a-curvedimage, a-text"></a-entity>
            <a-entity id="controller2" hand-controls="right" super-hands sphere-collider="objects: a-entity, a-box, a-image, a-video, a-curvedimage, a-text"></a-entity>
            <a-entity id="playeravatar" bones json-model="src: #arpitjson;" position="-1.5 .5 .5"></a-entity>
            <a-link href="https://aframe.io/aframe/examples/showcase/link-traversal/city.html" title="Warp to a New World!" image="#skyTexture" position="0 1 2" scale=".5 .5 .5" highlightedColor="#222222"></a-link>
            <!--<a-image src="#imagestretch" position="0 1 -0" stretchable grabbable></a-image>-->
            <a-entity welcomemessage="bgcolor:black; text:Welcome to Comcast's Web VR Experience!; textcolor:white;" position="0 2 -2" scale=".25 .25 .25"></a-entity>
        </a-scene>
        <script type="text/javascript">
            //Bad way of handling events - use custom components see cursor-scale component example above scene!
            var myBox = document.querySelector('#many-cube');
            var controller1 = document.querySelector("#controller1");
            var scene = document.querySelector("a-scene");

            console.log(document.querySelector("a-gui-slider"));
            document.querySelector('a-scene').addEventListener('loaded', function () {
                //Get axis values from controller1
                controller1.addEventListener("axismove", function(e){
                    console.log("x = " + e.detail.axis[0]);
                    console.log("y = " + e.detail.axis[1]);
                    mybone.position.x = e.detail.axis[0];
                    mybone.position.y = e.detail.axis[1];
                });

                //detect thumbstick press
                controller1.addEventListener("thumbstickdown", function(e){
                    console.log(e);
                    myBox.setAttribute("scale", {x: 1, y:1, z:1});
                    console.log(controller1.object3D.position);
                });

                //detect bottom grip press and scale custom box down
                controller1.addEventListener("gripdown", function(e){
                    console.log(e);
                    myBox.setAttribute("scale", {x:1, y:1, z:1});
                });

                var count = 0;
                document.addEventListener("keypress", function(e){
                    console.log(e);
                    if(e.charCode == 112){
                        count++;
                        if(count % 2 == 0){
                            onStopMocap();
                        } else {
                            onPlayMocap();
                        }
                    }
                });
            });

            function onPlayMocap(){
                var scene = document.querySelector("a-scene");
                scene.setAttribute("avatar-replayer", "");
                console.log("Playing Mocap");
                console.log(scene);
            }

            function onStopMocap(){
                var scene = document.querySelector("a-scene");
                scene.removeAttribute("avatar-replayer");
                console.log("Stopping Mocap");
                console.log(scene);
            }
        </script>
    </body>
</html>
